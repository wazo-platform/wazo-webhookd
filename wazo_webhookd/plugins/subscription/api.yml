paths:
  /subscriptions:
    get:
      summary: List subscriptions to HTTP callbacks
      description: '**Required ACL:** `webhookd.subscriptions.read`'
      operationId: list
      tags:
        - subscriptions
      responses:
        '200':
          description: List of the subscriptions
          schema:
            $ref: '#/definitions/SubscriptionList'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
    post:
      summary: Subscribe to a HTTP callback (webhook)
      description: '**Required ACL:** `webhookd.subscriptions.create`
      

      For more information: http://documentation.wazo.community/en/stable/api_sdk/rest_api/webhookd/api.html'
      operationId: create
      parameters:
        - $ref: '#/parameters/SubscriptionBody'
      tags:
        - subscriptions
      responses:
        '201':
          'description': The subscription has been completed
        '400':
          $ref: '#/responses/InvalidRequest'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
  /subscriptions/{subscription_uuid}:
    get:
      summary: Get a subscription
      description: '**Required ACL:** `webhookd.subscriptions.{subscription_uuid}.read`'
      operationId: get
      parameters:
        - $ref: '#/parameters/SubscriptionUUID'
      tags:
        - subscriptions
      responses:
        '200':
          description: Details of the requested subscription
          schema:
            $ref: '#/definitions/Subscription'
        '404':
          $ref: '#/responses/NotFoundError'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
    put:
      summary: Edit a subscription
      description: '**Required ACL:** `webhookd.subscriptions.{subscription_uuid}.update`'
      operationId: edit
      parameters:
        - $ref: '#/parameters/SubscriptionUUID'
        - $ref: '#/parameters/SubscriptionBody'
      tags:
        - subscriptions
      responses:
        '200':
          description: The requested subscription was edited
          schema:
            $ref: '#/definitions/Subscription'
        '400':
          $ref: '#/responses/InvalidRequest'
        '404':
          $ref: '#/responses/NotFoundError'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
    delete:
      summary: Delete a subscription
      description: '**Required ACL:** `webhookd.subscriptions.{subscription_uuid}.delete`'
      operationId: delete
      parameters:
        - $ref: '#/parameters/SubscriptionUUID'
      tags:
        - subscriptions
      responses:
        '204':
          description: The requested subscription was deleted
        '404':
          $ref: '#/responses/NotFoundError'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
  /users/me/subscriptions:
    get:
      summary: List subscriptions of a user to HTTP callbacks
      description: '**Required ACL:** `webhookd.users.me.subscriptions.read`'
      operationId: user_list
      tags:
        - subscriptions
        - users
      responses:
        '200':
          description: List of the subscriptions of the user
          schema:
            $ref: '#/definitions/SubscriptionList'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
    post:
      summary: Subscribe to a HTTP callback (webhook) as a user
      description: '**Required ACL:** `webhookd.users.me.subscriptions.create`


      For more information: http://documentation.wazo.community/en/stable/api_sdk/rest_api/webhookd/api.html'
      operationId: user_create
      parameters:
        - $ref: '#/parameters/UserSubscriptionBody'
      tags:
        - subscriptions
        - users
      responses:
        '201':
          'description': The subscription has been completed
        '400':
          $ref: '#/responses/InvalidRequest'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
  /users/me/subscriptions/{subscription_uuid}:
    get:
      summary: Get a user subscription
      description: '**Required ACL:** `webhookd.users.me.subscriptions.{subscription_uuid}.read`'
      operationId: get
      parameters:
        - $ref: '#/parameters/SubscriptionUUID'
      tags:
        - subscriptions
        - users
      responses:
        '200':
          description: Details of the requested subscription
          schema:
            $ref: '#/definitions/Subscription'
        '404':
          $ref: '#/responses/NotFoundError'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
    delete:
      summary: Delete a user subscription
      description: '**Required ACL:** `webhookd.users.me.subscriptions.{subscription_uuid}.delete`'
      operationId: user_delete
      parameters:
        - $ref: '#/parameters/SubscriptionUUID'
      tags:
        - subscriptions
        - users
      responses:
        '204':
          description: The requested subscription was deleted
        '404':
          $ref: '#/responses/NotFoundError'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
definitions:
  SubscriptionRequest:
    type: object
    properties:
      name:
        type: string
      service:
        type: string
        description: >
          Known services: http. The service may be arbitrary, but it must be bound to an installed plugin in order to be effective.
      config:
        $ref: '#/definitions/HTTPServiceConfig'
      events:
        type: array
        items:
          type: string
      events_user_uuid:
        type: string
        description: "Only trigger webhook when an event occurs related to this user. Not compatible with all events. For more details, see: http://documentation.wazo.community/en/latest/api_sdk/rest_api/webhookd/api.html."
    required:
      - name
      - service
      - config
      - events
  UserSubscriptionRequest:
    type: object
    properties:
      name:
        type: string
      service:
        type: string
        description: >
          Known services: http. The service may be arbitrary, but it must be bound to an installed plugin in order to be effective.
      config:
        $ref: '#/definitions/HTTPServiceConfig'
      events:
        type: array
        items:
          type: string
    required:
      - name
      - service
      - config
      - events
  Subscription:
    type: object
    properties:
      uuid:
        type: string
        readOnly: true
      name:
        type: string
      service:
        type: string
      config:
        $ref: '#/definitions/ServiceConfig'
      events:
        type: array
        items:
          type: string
      events_user_uuid:
        type: string
        description: "Only trigger webhook when an event occurs related to this user. Not compatible with all events. For more details, see: http://documentation.wazo.community/en/latest/api_sdk/rest_api/webhookd/api.html"
      owner_user_uuid:
        type: string
        readOnly: true
        description: "The user who owns this subscription. Admin-created subscriptions are not owned."
    required:
      - uuid
      - name
      - service
      - config
      - events
  ServiceConfig:
    type: object
    additionalProperties:
      type: string
  HTTPServiceConfig:
    type: object
    properties:
      url:
        type: string
        description: Jinja2 template, where variables come from the event triggering the webhook. For more details, see http://documentation.wazo.community/en/latest/api_sdk/rest_api/webhookd/templates.html
      method:
        type: string
        enum:
          - head
          - get
          - post
          - put
          - delete
      body:
        type: string
        description: Jinja2 template, where variables come from the event triggering the webhook. For more details, see http://documentation.wazo.community/en/latest/api_sdk/rest_api/webhookd/templates.html
      verify_certificate:
        description: May be `true`, `false` or a path to the certificate bundle
        type: string
        default: 'true'
      content_type:
        description: Content-Type of the body
        type: string
    required:
      - url
      - method
  SubscriptionList:
    type: object
    properties:
      items:
        type: array
        items:
          $ref: '#/definitions/Subscription'
        readOnly: true
      total:
        type: integer
        readOnly: true
    required:
      - items
      - total
parameters:
  SubscriptionUUID:
    type: string
    name: subscription_uuid
    description: The UUID of the subscription
    in: path
    required: true
  SubscriptionBody:
    name: body
    in: body
    required: true
    schema:
      $ref: '#/definitions/SubscriptionRequest'
